---
classes: 
  - 'profile::apache'
  
apache::vhosts:
  web.mcgahee.homelab:
    vhost_name: 'web.mcgahee.homelab'
    port: '80'
    docroot: '/var/www/html/'
    redirect_status: 'permanent'
    redirect_dest: 'https://web.mcgahee.homelab/'
  web.mcgahee.homelab:
    vhost_name: 'web.mcgahee.homelab'
    port: '443'
    docroot: '/var/www/html/'
    ssl: true
    ssl_cert: '/etc/apache2/ssl/web.mcgahee.homelab.crt'
    ssl_key: '/etc/apache2/ssl/web.mcgahee.homelab.key'
    
apache::vhosts::selfcerts: 
  exec: 'create_self_signed_sslcert'
    command: 'openssl req -newkey rsa:2048 -nodes -keyout ${apache::vhost::vhost_name}.key  -x509 -days 365 -out ${apache::vhost::vhost_name}.crt -subj "/CN=${apache::vhost::vhost_name}"'
    cwd: '/etc/ssl/'
    creates: '[ "/etc/ssl/${apache::vhost::vhost_name}.key", "/etc/ssl/${apache::vhost::vhost_name}.crt", ]'
    path: '["/usr/bin", "/usr/sbin"]'